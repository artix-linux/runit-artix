#!/bin/bash

# sourcing our current rc.conf requires this to be a bash script
. @RCLIBDIR@/functions

mount_api_fs(){
    mountpoint -q /run || mount -t tmpfs run /run -o mode=0755,nosuid,nodev
    findmnt / --options ro &>/dev/null || mount -o remount,ro /
}

umount_api_fs(){
    umount -r -a -t nosysfs,noproc,nodevtmpfs,notmpfs
}

case "$1" in
    start)
        stat_busy "Mounting api filesystems"
        mount_api_fs
        add_daemon api-fs
        stat_done
        ;;
    stop)
        stat_busy "Unounting api filesystems"
        umount_api_fs
        rm_daemon api-fs
        stat_done
        ;;
    *)
        echo "usage: $0 {start|stop}"
        exit 1
        ;;
esac
